@{
    var processId = ViewData["processId"];
    string type = ViewData["type"] as string;
    string typeResource = ViewData["typeResource"] as string;
    IEnumerable<Pmviz_Frontend.Models.Activity> activities = ViewData["activities"] as IEnumerable<Pmviz_Frontend.Models.Activity>;
    IEnumerable<Pmviz_Frontend.Models.Workstation> workstations = ViewData["workstations"] as IEnumerable<Pmviz_Frontend.Models.Workstation>;
    string activityChosen = ViewData["activity"] as string;
    string workstationChosen = ViewData["workstation"] as string;
    var moulds = ViewData["moulds"] as List<String>;
    var parts = ViewData["parts"] as List<String>;
    string hasValues = ViewData["hasValues"] as string;
    var meanMinutesAll = ViewData["meanMillis"];
    var totalEffort = ViewData["totalWorkHoursMillis"];
    var allResources = ViewData["allResources"] as IEnumerable<Pmviz_Frontend.Models.ResourceStat>;
    var allResourcesEffort = ViewData["allResourcesEffort"] as IEnumerable<Pmviz_Frontend.Models.ResourceEffort>;
    var operationalEffort = ViewData["allResourcesEffort"] as IEnumerable<Pmviz_Frontend.Models.WorkstationEffort>;
    IEnumerable<Pmviz_Frontend.Models.WorkstationFreq> frequency = ViewData["Frequency"] as IEnumerable<Pmviz_Frontend.Models.WorkstationFreq>;
    IEnumerable<Pmviz_Frontend.Models.WorkstationFreq> median = ViewData["Median"] as IEnumerable<Pmviz_Frontend.Models.WorkstationFreq>;
    IEnumerable<Pmviz_Frontend.Models.WorkstationFreq> mean = ViewData["Mean"] as IEnumerable<Pmviz_Frontend.Models.WorkstationFreq>;

}
@model IEnumerable<Pmviz_Frontend.Models.WorkstationFreq>
@{
    ViewData["Title"] = "Recursos";
}

<div class="row">
    <div class="col-md-3 col-xl-3">
        <div class="card-box">
            <h4 class="text-dark my-1">Estatísticas de Recursos</h4>
            @if (ViewBag.ErrorActivity != null)
            {
                <div class="alert alert-danger" role="alert">
                    @ViewBag.ErrorActivity
                </div>
            }
            @if (ViewBag.ErrorWorkstations != null)
            {
                <div class="alert alert-danger" role="alert">
                    @ViewBag.ErrorWorkstations
                </div>
            }
            @if (activities != null && workstations != null)
            {
                <form method="post" action='@Url.Action("Resource", "Log", new { id = processId })'>
                    <h6>Escolha um tipo de recurso:</h6>
                    @if (typeResource == "user")
                    {
                        <input type="radio" name="typeR" id="userCheck" value="user" checked>
                    }
                    else
                    {
                        <input type="radio" name="typeR" value="user" onclick="handleRadio(this);">

                    }
                    <label for="user">Utilizadores</label>
                    <br />
                    @if (typeResource == "workstation")
                    {
                        <input type="radio" name="typeR" id="workCheck" value="workstation" checked>
                    }
                    else
                    {
                        <input type="radio" name="typeR" value="workstation" onclick="handleRadio(this);">

                    }
                    <label for="workstation">Estações</label>
                    <br />
                    <h6>Escolha um tipo de estatísticas:</h6>
                    <div id="option">
                        @if (type == "mean")
                        {
                            <input type="radio" name="type" value="mean" checked>
                        }
                        else
                        {
                            <input type="radio" name="type" value="mean" id="typeWorkstation" onclick="handleMiner(this);">

                        }
                        <label for="mean">Desempenho</label>
                        <br />
                        @if (type == "effort")
                        {
                            <input type="radio" name="type" value="effort" checked>
                        }
                        else
                        {
                            <input type="radio" name="type" value="effort" onclick="handleMiner(this);">
                        }
                        <label for="effort">Tempo de Trabalho</label>
                        <br />
                        @if (type == "effortWorkstation")
                        {
                            <input type="radio" name="type" value="effortWorkstation" checked>
                        }
                        else
                        {
                            <input type="radio" name="type" value="effortWorkstation" onclick="handleMiner(this);">
                        }
                        <label for="effort">Trabalho por Estação</label>
                    </div>
                    <div id="option2">
                        @if (type == "meanWork")
                        {
                            <input type="radio" name="type" value="meanWork" checked>
                        }
                        else
                        {
                            <input type="radio" name="type" id="radioPerformanceWork" value="meanWork" onclick="handleMiner(this);">

                        }
                        <label for="mean">Desempenho das Estações</label>
                        <br />
                        @if (type == "effortWork")
                        {
                            <input type="radio" name="type" value="effortWork" checked>
                        }
                        else
                        {
                            <input type="radio" name="type" value="effortWork" onclick="handleMiner(this);">
                        }
                        <label for="effort">Tempo Operacional</label>
                    </div>

                    <br />
                    <div id="acts">
                        <h6>Escolha uma atividade:</h6>
                        <select name="activity" class="btn-sm btn-light dropdown-toggle" id="actv" onchange="handleAct(this)">
                            <option value="" disabled selected>Escolha uma atividade</option>

                            @foreach (var act in activities)
                            {
                                if (activityChosen == act.Id.ToString())
                                {
                                    <option value="@act.Id" selected>@act.Id - @act.Name</option>
                                }
                                else
                                {
                                    <option value="@act.Id">@act.Id - @act.Name</option>
                                }
                            }


                        </select>
                    </div>
                    <div id="stations">
                        <h6>Escolha uma Estação:</h6>
                        <select name="workstation" class="btn-sm btn-light dropdown-toggle" id="works" onchange="handleWork(this)">
                            <option value="" disabled selected>Escolha uma Estação</option>

                            @foreach (var w in workstations)
                            {
                                if (workstationChosen == w.Id.ToString())
                                {
                                    <option value="@w.Id" selected>@w.Id - @w.Name</option>
                                }
                                else
                                {
                                    <option value="@w.Id">@w.Id - @w.Name</option>
                                }
                            }


                        </select>
                    </div>
                    <br />
                    <div>
                        <button class="btn-xs btn-primary" type="submit" id="send" hidden>Submit</button>
                    </div>
                </form>
            }
            else
            {
                <div>
                    <a href='@Url.Action("Index","Log")' class="btn btn-danger">Voltar</a>
                </div>
            }
        </div>
    </div>
    <div class="col">
        @if (ViewBag.Error != null)
        {
            <div class="alert alert-danger" role="alert">
                @ViewBag.Error
            </div>
            <div class="container" style="text-align:center">
                <a href='@Url.Action("Index","Log")' class="btn btn-danger">Voltar</a>
            </div>
        }
        else
        {
            @if ((type == "mean" || type == "effort" || type == "effortWorkstation" || type == "effortWork" || type == "meanWork")
               && (meanMinutesAll != null || totalEffort != null || hasValues == "true"))
            {
                <div class="card-box">
                    @if (type == "meanWork")
                    {
                        <div class="col">
                            <div class="container-fluid" style="text-align:center">
                                <button class="btn btn-primary" id="frequencyButton" type="button">Frequência</button>
                                <button class="btn btn-primary" id="medianButton" type="button">Mediana</button>
                                <button class="btn btn-primary" id="meanButton" type="button">Média</button>
                            </div>
                            <br />
                            <div id="frequencyChart">
                                @(Html.Kendo().Chart(frequency)
                                            .Name("chart")
                                            .Legend(legend => legend
                                            .Position(ChartLegendPosition.Top))
                                            .Series(series =>
                                            {
                                                series.Column(a => a.Frequency).Name("Frequência").CategoryField("Workstation");
                                            })
                                            .CategoryAxis(axis => axis
                                                .Labels(labels => labels.Rotation(0))
                                                .MajorGridLines(lines => lines.Visible(true))
                                            )
                                            .ValueAxis(axis => axis
                                                .Labels(l => l.Visible(true))
                                                .Title("Frequência")
                                            )
                                        .Tooltip(tooltip => tooltip
                                            .Visible(true)
                                            .Template("#= series.name #: #= value #")
                                        )
                                        .ChartArea(x => x.Height(210))
                                        .Pannable(pannable => pannable
                                            .Lock(ChartAxisLock.Y)
                                        )
                                        .Zoomable(zoomable => zoomable
                                            .Mousewheel(mousewheel => mousewheel.Lock(ChartAxisLock.Y))
                                            .Selection(selection => selection.Lock(ChartAxisLock.Y))
                                        )


                                )
                            </div>
                            <div id="medianChart">
                                @(Html.Kendo().Chart(median)
                                    .Name("chart_median")
                                    .Legend(legend => legend
                                        .Position(ChartLegendPosition.Top))
                                    .Series(series =>
                                    {
                                        series.Column(a => a.MedianInMinutes).Name("Mediana em Minutos").CategoryField("Workstation");
                                    })
                                    .CategoryAxis(axis => axis
                                        .Labels(labels => labels.Rotation(0))
                                        .MajorGridLines(lines => lines.Visible(true))
                                    )
                                    .ValueAxis(axis => axis
                                        .Labels(l => l.Visible(true))
                                        .Title("Mediana")
                                    )
                                    .Tooltip(tooltip => tooltip
                                        .Visible(true)
                                        .Template("#= dataItem.MedianActivityFormatted #")
                                    )
                                    .ChartArea(x => x.Height(210))
                                    .Pannable(pannable => pannable
                                        .Lock(ChartAxisLock.Y)
                                    )
                                    .Zoomable(zoomable => zoomable
                                        .Mousewheel(mousewheel => mousewheel.Lock(ChartAxisLock.Y))
                                        .Selection(selection => selection.Lock(ChartAxisLock.Y))
                                    )
                                )

                            </div>
                            <div id="meanChart">
                                @(Html.Kendo().Chart(mean)
                                .Name("chart_mean")
                                .Legend(legend => legend
                                    .Position(ChartLegendPosition.Top))
                                .Series(series =>
                                {
                                    series.Column(a => a.MeanInMinutes).Name("Média em Minutos").CategoryField("Workstation");
                                })
                                .CategoryAxis(axis => axis
                                    .Labels(labels => labels.Rotation(0))
                                    .MajorGridLines(lines => lines.Visible(true))
                                )
                                .ValueAxis(axis => axis
                                    .Labels(l => l.Visible(true))
                                    .Title("Média")
                                )
                                .Tooltip(tooltip => tooltip
                                    .Visible(true)
                                    .Template("#= dataItem.MeanActivityFormatted #")
                                )
                                .ChartArea(x => x.Height(210))
                                .Pannable(pannable => pannable
                                    .Lock(ChartAxisLock.Y)
                                )
                                .Zoomable(zoomable => zoomable
                                    .Mousewheel(mousewheel => mousewheel.Lock(ChartAxisLock.Y))
                                    .Selection(selection => selection.Lock(ChartAxisLock.Y))
                                )
                                )

                            </div>
                        </div>

                    }
                    else if (type == "mean")
                    {
                        <div>
                            @(Html.Kendo().Chart(allResources)
                                .Name("chart")
                                .Title("Média")
                                .Legend(legend => legend
                                    .Position(ChartLegendPosition.Top)
                                )
                                .Series(series =>
                                {
                                    series.Column(a => a.MeanMillis).Name("Média em Minutos").CategoryField("Resource");
                                })
                                .CategoryAxis(axis => axis
                                    .Name("series-axis")
                                    .Line(line => line.Visible(true))
                                )
                                .Tooltip(tooltip => tooltip
                                    .Visible(true)
                                    .Format("{0}%")
                                    .Template("#= series.name #: #= value # minutos")
                                )
                                .ChartArea(x => x.Height(210))
                                .Pannable(pannable => pannable
                                    .Lock(ChartAxisLock.Y)
                                )
                                .Zoomable(zoomable => zoomable
                                    .Mousewheel(mousewheel => mousewheel.Lock(ChartAxisLock.Y))
                                    .Selection(selection => selection.Lock(ChartAxisLock.Y))
                                )


                            )
                        </div>

                    }
                    else if (type == "effort" || type == "effortWorkstation")
                    {
                        <div>
                            @(Html.Kendo().Chart(allResourcesEffort)
                                .Name("chart")
                                .Title("Tempo de Trabalho")
                                .Legend(legend => legend
                                    .Position(ChartLegendPosition.Top)
                                )
                                .Series(series =>
                                {
                                    series.Column(a => a.WorkHoursMillis).Name("Tempo de Trabalho em Minutos").CategoryField("Username");
                                })
                                .CategoryAxis(axis => axis
                                    .Name("series-axis")
                                    .Line(line => line.Visible(true))
                                )
                                .Tooltip(tooltip => tooltip
                                    .Visible(true)
                                    .Format("{0}%")
                                    .Template("#= series.name #: #= value # minutos")
                                )
                                .ChartArea(x => x.Height(210))
                                .Pannable(pannable => pannable
                                    .Lock(ChartAxisLock.Y)
                                )
                                .Zoomable(zoomable => zoomable
                                    .Mousewheel(mousewheel => mousewheel.Lock(ChartAxisLock.Y))
                                    .Selection(selection => selection.Lock(ChartAxisLock.Y))
                                )


                            )
                        </div>
                    }
                    else
                    {
                        <div>
                            @(Html.Kendo().Chart(operationalEffort)
                                .Name("chart")
                                .Title("Tempo Operacional")
                                .Legend(legend => legend
                                    .Position(ChartLegendPosition.Top)
                                )
                                .Series(series =>
                                {
                                    series.Column(a => a.OperationalHoursMillis).Name("Tempo Operacional em Minutos").CategoryField("WorkstationName");
                                })
                                .CategoryAxis(axis => axis
                                    .Name("series-axis")
                                    .Line(line => line.Visible(true))
                                )
                                .Tooltip(tooltip => tooltip
                                    .Visible(true)
                                    .Format("{0}%")
                                    .Template("#= series.name #: #= value # minutos")
                                )
                                .ChartArea(x => x.Height(210))
                                .Pannable(pannable => pannable
                                    .Lock(ChartAxisLock.Y)
                                )
                                .Zoomable(zoomable => zoomable
                                    .Mousewheel(mousewheel => mousewheel.Lock(ChartAxisLock.Y))
                                    .Selection(selection => selection.Lock(ChartAxisLock.Y))
                                )


                            )
                        </div>
                    }


                </div>
            }
        }
    </div>
</div>
<br />


@if ((type == "mean" || type == "effort" || type == "effortWorkstation" || type == "effortWork" || type == "meanWork")
   && (meanMinutesAll != null || totalEffort != null || hasValues == "true"))
{
    <div class="row">
        @if (type == "meanWork")
        {
            <div class="col">
                @if (Model != null)
                {
                    <div class="table-responsive">
                        <table id="scroll-horizontal-datatable" class="table table-dark dt-responsive nowrap w-100">
                            <thead>
                                <tr>
                                    <th>Frequência</th>
                                    <th>Média</th>
                                    <th>Mediana</th>
                                    <th>Duração Mínima</th>
                                    <th>Duração Máxima</th>
                                    <th>Workstation</th>
                            </thead>
                            <tbody>

                                @foreach (Pmviz_Frontend.Models.WorkstationFreq a in Model)
                                {
                                    <tr>
                                        <td>@a.Frequency</td>
                                        <td>@a.MeanActivityFormatted</td>
                                        <td>@a.MedianActivityFormatted</td>
                                        <td>@a.MinActivityFormatted</td>
                                        <td>@a.MaxActivityFormatted</td>
                                        <td>@a.Workstation</td>
                                    </tr>

                                }

                            </tbody>
                        </table>
                    </div>

                }
            </div>

        }
        else
        {
            <div class="col">
                <div class="card text-xs-center">
                    <div class="card-header">
                        Information
                    </div>
                    <div class="card-body">
                        @if (type == "mean")
                        {
                            <h5>
                                Desempenho médio: @meanMinutesAll minutos
                            </h5>
                        }
                        else if (type == "effort" || type == "effortWorkstation")
                        {
                            <h5>
                                Tempo de Trabalho Total: @totalEffort minutos
                            </h5>
                        }
                        else
                        {
                            <h5>
                                Tempo Operacional: @totalEffort minutos
                            </h5>
                        }
                        <h5>
                            Atividade Escolhida: @activityChosen
                        </h5>
                    </div>
                </div> <!-- end card-box-->
            </div> <!-- end col -->
            <div class="col">
                <div class="card text-xs-center">
                    <div class="card-header">
                        Peças
                    </div>
                    <div class="card-body">
                        @if (parts == null)
                        {
                            <h5>Nenhuma peça.</h5>
                        }
                        else
                        {
                            foreach (var p in parts)
                            {
                                <h5>@p</h5>
                            }
                        }
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card text-xs-center">
                    <div class="card-header">
                        Molde
                    </div>
                    <div class="card-body">
                        @if (moulds == null)
                        {
                            <h5>Nenhum molde.</h5>
                        }
                        else
                        {
                            foreach (var m in moulds)
                            {
                                <h5>@m</h5>
                            }
                        }
                    </div>
                </div>
            </div>
        }
    </div>
}

<script>
    var select = document.getElementById("acts");
    var selectWork = document.getElementById("stations")
    var selectList = document.getElementById("actv");
    var selectListWorkstations = document.getElementById("works");
    var userTypeDiv = document.getElementById("option");
    var workstationTypeDiv = document.getElementById("option2");
    var btnSubmit = document.getElementById("send");
    var radioPerformanceUser = document.getElementById("typeWorkstation");
    var radioPerformanceWork = document.getElementById("radioPerformanceWork");
    var userCheck = document.getElementById("userCheck");
    var workCheck = document.getElementById("workCheck");


    if (userCheck != null) {
        userTypeDiv.style.display = "block"
        workstationTypeDiv.style.display = "none"
    }

    if (workCheck != null) {
        userTypeDiv.style.display = "none"
        workstationTypeDiv.style.display = "block"
    }

    $(document).ready(function () {
        var frequencyChart = document.getElementById("frequencyChart");
        var medianChart = document.getElementById("medianChart");
        var meanChart = document.getElementById("meanChart");
        var frequencyButton = document.getElementById("frequencyButton");
        var medianButton = document.getElementById("medianButton");
        var meanButton = document.getElementById("meanButton");

        medianChart.style.display = "none";
        meanChart.style.display = "none";
        frequencyButton.disabled = true;

        $("#frequencyButton").click(function () {
            frequencyButton.disabled = true;
            medianButton.disabled = false;
            meanButton.disabled = false;
            frequencyChart.style.display = "block";
            medianChart.style.display = "none";
            meanChart.style.display = "none";
        });

        $("#medianButton").click(function () {
            frequencyButton.disabled = false;
            medianButton.disabled = true;
            meanButton.disabled = false;
            frequencyChart.style.display = "none";
            medianChart.style.display = "block";
            meanChart.style.display = "none";
        });

        $("#meanButton").click(function () {
            frequencyButton.disabled = false;
            medianButton.disabled = false;
            meanButton.disabled = true;
            frequencyChart.style.display = "none";
            medianChart.style.display = "none";
            meanChart.style.display = "block";
        });
    });

    if (selectList.value == "") {
        select.style.display = "none";

    }

    if (selectListWorkstations.value == "") {
        selectWork.style.display = "none";

    }

    function handleAct(selectBox) {
        btnSubmit.click()
    }

    function handleWork(selectBox) {
        btnSubmit.click()
    }


    function handleMiner(radio) {
        if (radio.value == "mean" || radio.value == "effort") {
            selectWork.style.display = "none";
            select.style.display = "block";
        } else if (radio.value == "effortWorkstation") {
            select.style.display = "none";
            selectWork.style.display = "block";
        }

        if (selectList.value == "") {

        }
        else if (selectList.value != "" && (radio.value == "mean" || radio.value == "effort" || radio.value == "effortWork" || radio.value == "meanWork")) {
            btnSubmit.click()

        }

        if (selectListWorkstations.value == "") {

        }
        else if (selectListWorkstations.value != "" && radio.value == "effortWorkstation") {
            btnSubmit.click()

        }
    }

    function handleRadio(radio) {
        if (radio.value == "user") {
            radioPerformanceUser.checked = true
            userTypeDiv.style.display = "block"
            workstationTypeDiv.style.display = "none"
            select.style.display = "block";
            if (selectListWorkstations == "") {

            }
            else if (selectListWorkstations.value != "") {
                btnSubmit.click()
            }

        } else if (radio.value == "workstation") {
            radioPerformanceWork.checked = true
            userTypeDiv.style.display = "none"
            workstationTypeDiv.style.display = "block"
            selectWork.style.display = "none";
            select.style.display = "block";
        }

        if (selectList.value == "") {

        }
        else if (selectList.value != "") {
            btnSubmit.click()
        }


    }


</script>



