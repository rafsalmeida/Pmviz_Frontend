@{
    ViewData["Title"] = "Freq. Perf. Process";
}
<link href="@Url.Content("~/css/Graphs.css")" rel="stylesheet" />
<link href="@Url.Content("~/css/Loading.css")" rel="stylesheet" />
<div id="loader" style="display: none;"></div>
<style>
    .dot {
        height: 25px;
        width: 25px;
        background-color: #bbb;
        border-radius: 50%;
        display: inline-block;
    }
    .dot-blue {
        background-color: #acbcff;
    }
    #grad1 {
        height: 150px;
        width: 50px;
        background: linear-gradient(to bottom, #0032ff 25%, #365eff 25%, #365eff 50%, #748fff 50%, #748fff 75%, #acbcff 75%, #acbcff 100%);
    }

    #listLegend li {
        height: 37.5px;
        display: flex;
        flex-direction: row;
        align-items: center;
    }

    }
</style>
<div id="page">
    <div class="row">
        <div class="col-md-5">
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="graph" id="frequencyRadio" value="frequency" onclick="handleGraph(this);" checked>
                <label class="form-check-label" for="frequencyRadio">Grafo frequência</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="graph" id="performanceRadio" onclick="handleGraph(this);" value="performance">
                <label class="form-check-label" for="performanceRadio">Grafo performance</label>
            </div>
            <hr />
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="miner" id="alphaRadio" value="alpha-miner" onclick="handleMiner(this);" checked>
                <label class="form-check-label" for="alphaRadio">Alpha Miner</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="miner" id="heuristicRadio" onclick="handleMiner(this);" value="heuristic-miner">
                <label class="form-check-label" for="heuristicRadio">Heuristic Miner</label>
            </div>
            <div class="form-group" id="divTreshold">
                <label for="thresholdInput">Threshold</label>
                <input type="number" class="form-control" id="thresholdInput" value="0.1" step=".1" min="0" max="1">
                <small id="thresholdHelp" class="form-text text-muted">O threshold tem que estar entre 0 e 1</small>
            </div>
            <hr />
            <h4 id="processSelected">Seleccione o processo de referência</h4>
            <div class="row" style="height: 120px; ">
                <div class="col-sm-10">
                    <br />
                    <label class="form-check-label" for="processRadio">Processos</label>
                    <select id="inputProcesses" name="processes" class="form-control">
                        <option value="" disabled selected>Escolha um processo</option>
                    </select>
                </div>
            </div>
            <br />
            <div class="row justify-content-center">
                <div class="col-md-6">

                </div>
                <div class="col-md-2">
                    <button id="centerButton" class="btn pull-right" style="display: none;"><i class="fas fa-project-diagram"></i>Centrar Grafo</button>
                </div>
            </div>
            <br />
            <div id="infoFrequency" class="alert alert-info" role="alert" style="width:95%;display: none;">
                <strong>Informação!</strong> O grafo indica a frequência de cada atividade do processo seleccionado.
            </div>
            <div id="infoPerformance" class="alert alert-info" role="alert" style="width:95%;display: none;">
                <strong>Informação!</strong> O grafo indica a performance, <strong>em minutos</strong>, de cada atividade do processo seleccionado.
            </div>
            <!--<div id="cardInfo" class="card">
                <div class="card-body">
                    <p>Frequência</p>
                    <div class="row">
                        <div id="grad1"></div>
                        <ul class="list-unstyled align-bottom" id="listLegend">
                            <li>4</li>
                            <li>3</li>
                            <li>0</li>
                            <li>0</li>
                        </ul>
                    </div>
                    <br />
                                <span class="dot dot-blue"></span><span class="align-top"> Frequência</span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
    </div>
        </div>-->
        </div>
        <div class="col-sm-7" style="height: 85vh;">
            <div id="cy"></div>
        </div>
    </div>
</div>

<script src="@Url.Content("~/vendor/cytoscape/dist/cytoscape.min.js")"></script>
<script src="@Url.Content("~/vendor/moment/min/moment.min.js")"></script>
<script>
    /*
    var frequencyButton = document.getElementById("frequencyButton");
    var performanceButton = document.getElementById("performanceButton");
    var conformanceButton = document.getElementById("conformanceButton");
    var conformanceStats = document.getElementById("conformanceStats");

    conformanceButton.style.display = "none";

    var inputSubprocesses = document.getElementById("inputSubprocesses");
    var inputMoulds = document.getElementById("inputMoulds");
    var inputParts = document.getElementById("inputParts");
    */
    var divTreshold = document.getElementById("divTreshold");
    var thresholdInput = document.getElementById("thresholdInput");
    var divLoader = document.getElementById("loader");
    var divPage = document.getElementById("page");
    var infoFrequency = document.getElementById("infoFrequency");
    var infoPerformance = document.getElementById("infoPerformance");
    var centerButton = document.getElementById("centerButton");
    var processes = JSON.parse(@Html.Raw(Json.Serialize(ViewData["processes"])));
    var cy = null;

    var process = {
        idProcess: '',
        nameProcess: '',
        miner: 'alpha-miner',
        graph: 'frequency',
        data: '',
        nodeTimes: [],
        relationTimes: [],
        edgesMaxTime: '',
        nodesMaxTime: ''
    };
    /*
    var data = {
        dataAlpha: JSON.parse(Html.Raw(Json.Serialize(ViewData["alpha"]))),
        dataHeuristic: JSON.parse(Html.Raw(Json.Serialize(ViewData["heuristic"]))),
        dataConformance: JSON.parse(Html.Raw(Json.Serialize(ViewData["conformance"]))),
        dataCompare: JSON.parse(Html.Raw(Json.Serialize(ViewData["compare"])))
    }
    var graph = {
        typeGraph: "Frequency",
        typeAlgth: 0,
        data: data.dataAlpha,
        caseData: data.dataCompare,
        maxFrequency: null,
        nodeTimes: null,
        relationTimes: null,
        nodesMaxTime: null,
        edgesMaxTime: null
    };*/

    divTreshold.style.display = "none";

    function handleGraph(myRadio) {
        if (myRadio.value == 'frequency') {
            process.graph = 'frequency';       
        } else {
            process.graph = 'performance';
        }
        if (process.idProcess) {
            generateGraph();
        }
    }

    function handleMiner(myRadio) {
        if (myRadio.value == 'alpha-miner') {
            process.miner = 'alpha-miner';
            divTreshold.style.display = "none";
        } else {
            process.miner = 'heuristic-miner';
            divTreshold.style.display = "block";
        }
        if (process.idProcess) {
            getData();
        }
    }

    (function($){
        $.fn.extend({
            donetyping: function(callback,timeout){
                timeout = timeout || 1e3;
                var timeoutReference,
                    doneTyping = function(el){
                        if (!timeoutReference) {
                            return;
                        }
                        timeoutReference = null;
                        callback.call(el);
                    };
                return this.each(function(i,el){
                    var $el = $(el);
                    $el.is(':input') && $el.on('keyup keypress paste',function(e){
                        if (e.type == 'keyup' && e.keyCode != 8) {
                            return;
                        }
                        if (timeoutReference) {
                            clearTimeout(timeoutReference);
                        }
                        timeoutReference = setTimeout(function(){
                            doneTyping(el);
                        }, timeout);
                    }).on('blur',function(){
                        doneTyping(el);
                    });
                });
            }
        });
    })(jQuery);

    $('#thresholdInput').donetyping(function(){
        if (process.idProcess && $(this).val() >= 0 && $(this).val() <= 1) {
            getData();
        }
    });

    if (processes.length != 0) {
        for (var i = 0; i < processes.length; i++) {
            var option = document.createElement("option");
            option.setAttribute("value", processes[i].id);
            option.text = processes[i].name;
            inputProcesses.appendChild(option);
        }
    }

    function loading(x, y) {
        x.style.display = "none";
        y.style.display = "block";
    }

    function generateGraph() {
        if (process.graph == 'frequency') {
            renderCytoscapeElementFrequency();
            infoPerformance.style.display = "none";
            infoFrequency.style.display = "block";
        } else {
            let nodeTimes = [];
            for (let i = 0; i < process.data.statistics.nodes.length; i++) {
                let meanDuration = process.data.statistics.nodes[i].meanDuration.days + '.' + process.data.statistics.nodes[i].meanDuration.hours + ':' +
                    process.data.statistics.nodes[i].meanDuration.minutes + ':' + process.data.statistics.nodes[i].meanDuration.seconds + '.' + process.data.statistics.nodes[i].meanDuration.millis;
                nodeTimes[i] = moment.duration(meanDuration).asMinutes();
            }

            let relationTimes = [];
            for (let i = 0; i < process.data.statistics.relations.length; i++) {
                let relationTimesTemp = [];
                for (let j = 0; j < process.data.statistics.relations[i].to.length; j++) {
                    let meanDuration = process.data.statistics.relations[i].to[j].meanDuration.days + '.' + process.data.statistics.relations[i].to[j].meanDuration.hours + ':' +
                        process.data.statistics.relations[i].to[j].meanDuration.minutes + ':' + process.data.statistics.relations[i].to[j].meanDuration.seconds + '.' + process.data.statistics.relations[i].to[j].meanDuration.millis;
                    relationTimesTemp[j] = moment.duration(meanDuration).asMinutes();
                }
                relationTimes[i] = relationTimesTemp;
            }

            process.nodeTimes = nodeTimes;
            process.relationTimes = relationTimes;
            renderCytoscapeElementPerformance();
            infoFrequency.style.display = "none";
            infoPerformance.style.display = "block";
        }
    }

    function getData() {
        loading(divPage, divLoader);
        $.ajax({
            type: "POST",
            data: {
                process: process.idProcess,
                miner: process.miner,
                threshold: thresholdInput.value
            },
            url: "/Graph/GetWorkFlow",
            dataType: 'json',
            success: function (response) {
                if (response.success) {
                    $('#processSelected').empty();
                    $('#processSelected').text('Processo Seleccionado: ' + process.nameProcess);
                    process.data = response.request;
                    loading(divLoader, divPage);
                    centerButton.style.display = "block";
                    generateGraph();
                } else {
                    $('#processSelected').empty();
                    $('#processSelected').text('Escolha o processo de referência');
                    centerButton.style.display = "none";
                    cy = null;
                }
            },
            error: function (response) {
                alert("error!");  //
            }
        });
    }

    $("#inputProcesses").change(function () {
        if ($(this).val() != 0) {
            process.idProcess = $(this).val();
            process.nameProcess = $('#inputProcesses option:selected').text();
            getData();
        }else {
            process.idProcess = '';
            process.nameProcess = '';
        }
    });

    function renderCytoscapeElementFrequency() {
    cy = cytoscape(
        {
            wheelSensitivity: 0.5,
            minZoom: 0.1,
            maxZoom: 1,
            container: document.getElementById('cy'),
            style: [
                {
                    //Nodes styles
                    selector: 'node[type=0]',
                    style: {
                        "shape": 'rectangle',
                        "background-color": "#FFFFFF",
                        "label": "data(label)",
                        'width': '350',
                        "height": "40",
                        "border-width": 2,
                        "border-color": "#484848",
                        "font-size": "16px",
                        "text-valign": "center",
                        "text-halign": "center",
                        "text-wrap": "wrap",
                        "text-max-width": "1000px",
                        "color": "#222222"
                    }
                },
                {
                    selector: 'node[type=1]',
                    style: {
                        "shape": 'rectangle',
                        "background-color": "#acbcff",
                        "label": "data(label)",
                        'width': '350',
                        "height": "40",
                        "border-width": 2,
                        "border-color": "#484848",
                        "font-size": "16px",
                        "text-valign": "center",
                        "text-halign": "center",
                        "color": "#222222"
                    }
                },
                {
                    selector: 'node[type=2]',
                    style: {
                        "shape": 'rectangle',
                        "background-color": "#748fff",
                        "label": "data(label)",
                        'width': '350',
                        "height": "40",
                        "border-width": 2,
                        "border-color": "#484848",
                        "font-size": "16px",
                        "text-valign": "center",
                        "text-halign": "center",
                        "color": "#222222"
                    }
                },
                {
                    selector: 'node[type=3]',
                    style: {
                        "shape": 'rectangle',
                        "background-color": "#365eff",
                        "label": "data(label)",
                        'width': '350',
                        "height": "40",
                        "border-width": 2,
                        "border-color": "#484848",
                        "font-size": "16px",
                        "text-valign": "center",
                        "text-halign": "center",
                        "color": "#222222"
                    }
                },
                {
                    selector: 'node[type=4]',
                    style: {
                        "shape": 'rectangle',
                        "background-color": "#0032ff",
                        "label": "data(label)",
                        'width': '350',
                        "height": "40",
                        "border-width": 2,
                        "border-color": "#484848",
                        "font-size": "16px",
                        "text-valign": "center",
                        "text-halign": "center",
                        "color": "#FFFFFF"
                    }
                },
                {
                    //process start node
                    selector: 'node[type=20]',
                    style: {
                        "shape": 'ellipse',
                        "background-color": "#3f3f3f",
                        "border-width": 4,
                        "border-color": "#131313",
                        'width': '50',
                        "height": "50",
                        "font-size": "16px",
                        "text-valign": "center",
                        "text-halign": "center",
                        "text-wrap": "wrap",
                        "text-max-width": "1000px",
                        "color": "#FF2222"
                    }
                },

                //Edges styles
                {
                    selector: 'edge[type=0]',
                    style: {
                        'width': 3,
                        'curve-style': 'bezier',
                        "content": "data(name)",
                        "line-color": "#D1D1D1",
                        'target-arrow-color': '#D1D1D1',
                        "font-size": "32px",
                        "color": "#222222",
                        "loop-direction": "0deg",
                        'target-arrow-shape': 'triangle',
                        "loop-sweep": "45deg",
                        "text-margin-y": "-15px",
                        "source-text-offset": "50px"
                    }
                },
                {
                    selector: 'edge[type=1]',
                    style: {
                        'width': 5,
                        'curve-style': 'bezier',
                        "content": "data(name)",
                        "line-color": "#acbcff",
                        'target-arrow-color': '#acbcff',
                        "font-size": "32px",
                        "color": "#222222",
                        "loop-direction": "0deg",
                        'target-arrow-shape': 'triangle',
                        "loop-sweep": "45deg",
                        "text-margin-y": "-15px",
                        "source-text-offset": "50px"
                    }
                },
                {
                    selector: 'edge[type=2]',
                    style: {
                        'width': 7,
                        'curve-style': 'bezier',
                        "content": "data(name)",
                        "line-color": "#748fff",
                        'target-arrow-color': '#748fff',
                        "font-size": "32px",
                        "color": "#222222",
                        "loop-direction": "0deg",
                        'target-arrow-shape': 'triangle',
                        "loop-sweep": "45deg",
                        "text-margin-y": "-15px",
                        "source-text-offset": "50px"
                    }
                },
                {
                    selector: 'edge[type=3]',
                    style: {
                        'width': 9,
                        'curve-style': 'bezier',
                        "content": "data(name)",
                        "line-color": "#365eff",
                        'target-arrow-color': '#365eff',
                        "font-size": "32px",
                        "color": "#222222",
                        "loop-direction": "0deg",
                        'target-arrow-shape': 'triangle',
                        "loop-sweep": "45deg",
                        "text-margin-y": "-15px",
                        "source-text-offset": "50px"
                    }
                },
                {
                    selector: 'edge[type=4]',
                    style: {
                        'width': 13,
                        'curve-style': 'bezier',
                        "content": "data(name)",
                        "line-color": "#0032ff",
                        'target-arrow-color': '#0032ff',
                        "font-size": "32px",
                        "color": "#222222",
                        "loop-direction": "0deg",
                        'target-arrow-shape': 'triangle',
                        "loop-sweep": "45deg",
                        "text-margin-y": "-15px",
                        "source-text-offset": "50px"
                    }
                },
                {
                    //process start edge
                    selector: 'edge[type=20]',
                    style: {
                        'width': 8,
                        'curve-style': 'bezier',
                        'line-color': "#232323",
                        'target-arrow-color': '#232323',
                        "font-size": "32px",
                        "color": "#222222",
                        "loop-direction": "0deg",
                        'target-arrow-shape': 'triangle',
                        "loop-sweep": "45deg",
                        "text-margin-y": "-15px",
                        "source-text-offset": "50px",
                        "text-outline-color": "#222222",
                        "text-outline-width": "0.3px"
                    }
                },
            ],
        });
    //find max frequency value
    //nodes max frequency
    var maxFrequency = 0;
    for (let i = 0; i < process.data.nodes.length; i++) {
        if (process.data.statistics.nodes[i].frequency > maxFrequency) {
            maxFrequency = process.data.statistics.nodes[i].frequency;
        }
    }

    //edges max frequency
    for (let i = 0; i < process.data.statistics.relations.length; i++) {
        for (let j = 0; j < process.data.statistics.relations[i].to.length; j++) {
            if (process.data.statistics.relations[i].to[j].frequency > maxFrequency) {
                maxFrequency = process.data.statistics.relations[i].to[j].frequency;
            }
        }
    }
    var legendSetUp = [0, 0, 0, 0];
    //Nodes\\
    for (let i = 0; i < process.data.nodes.length; i++) {
        let typeValue = Math.round(process.data.statistics.nodes[i].frequency * 4 / maxFrequency);
        //asd[typeValue] = process.data.statistics.nodes[i].frequency;
        cy.add({
            data: {
                id: i,
                label: process.data.nodes[i] + ' (' + process.data.statistics.nodes[i].frequency + ')',
                type: typeValue
            },
        }
        );
    }
    process.maxFrequency = maxFrequency;

    //Edges\\
    for (let i = 0; i < process.data.relations.length; i++) {
        for (let j = 0; j < process.data.relations[i].to.length; j++) {
            let typeValue = Math.round(process.data.statistics.relations[i].to[j].frequency * 4 / maxFrequency);
            cy.add({
                data: {
                    id: 'edge' + process.data.relations[i].from + '-' + process.data.relations[i].to[j],
                    source: process.data.relations[i].from,
                    target: process.data.relations[i].to[j],
                    name: process.data.statistics.relations[i].to[j].frequency,
                    type: typeValue
                }
            });
        }
    }

    //add process start and end nodes
    for (let i = 0; i < process.data.startEvents.length; i++) {
        cy.add({
            data: {
                id: 'start-' + i,
                type: 20
            },
        });

        cy.add({
            data: {
                id: 'edge_start-' + i,
                source: 'start-' + i,
                target: process.data.startEvents[i].node,
                type: 20
            }
        });
    }

    for (let i = 0; i < process.data.endEvents.length; i++) {
        cy.add({
            data: {
                id: 'end-' + i,
                type: 20
            },
        });

        cy.add({
            data: {
                id: 'edge_end-' + i,
                source: process.data.endEvents[i].node,
                target: 'end-' + i,
                type: 20
            }
        });
    }

    let customBreadthfirst = {
        name: 'breadthfirst',

        fit: true, // whether to fit the viewport to the graph
        directed: true, // whether the tree is directed downwards (or edges can point in any direction if false)
        padding: 10, // padding on fit
        circle: false, // put depths in concentric circles if true, put depths top down if false
        grid: false, // whether to create an even grid into which the DAG is placed (circle:false only)
        spacingFactor: 0.90, // positive spacing factor, larger => more space between nodes (N.B. n/a if causes overlap)
        boundingBox: undefined, // constrain layout bounds; { x1, y1, x2, y2 } or { x1, y1, w, h }
        avoidOverlap: true, // prevents node overlap, may overflow boundingBox if not enough space
        nodeDimensionsIncludeLabels: false, // Excludes the label when calculating node bounding boxes for the layout algorithm
        roots: undefined, // the roots of the trees
        maximal: false, // whether to shift nodes down their natural BFS depths in order to avoid upwards edges (DAGS only)
        animate: false, // whether to transition the node positions
        animationDuration: 500, // duration of animation in ms if enabled
        animationEasing: undefined, // easing of animation if enabled,
        animateFilter: function (node, i) {
            return true;
        }, // a function that determines whether the node should be animated.  All nodes animated by default on animate enabled.  Non-animated nodes are positioned immediately when the layout starts
        ready: undefined, // callback on layoutready
        stop: undefined, // callback on layoutstop
        transform: function (node, position) {
            return position;
        } // transform a given node position. Useful for changing flow direction in discrete layouts
    };

    cy.layout(customBreadthfirst).run();
    };
    function renderCytoscapeElementPerformance() {
        cy = cytoscape(
            {
                wheelSensitivity: 0.5,
                minZoom: 0.1,
                maxZoom: 1,
                container: document.getElementById('cy'),

                style: [
                    {
                        //Nodes styles
                        selector: 'node[type=0]',
                        style: {
                            "shape": 'rectangle',
                            "background-color": "#FFFFFF",
                            "label": "data(label)",
                            'width': '350',
                            "height": "40",
                            "border-width": 2,
                            "border-color": "#484848",
                            "font-size": "16px",
                            "text-valign": "center",
                            "text-halign": "center",
                            "color": "#222222"
                        }
                    },
                    {
                        selector: 'node[type=1]',
                        style: {
                            "shape": 'rectangle',
                            "background-color": "#FFB7B7",
                            "label": "data(label)",
                            'width': '350',
                            "height": "40",
                            "border-width": 2,
                            "border-color": "#484848",
                            "font-size": "16px",
                            "text-valign": "center",
                            "text-halign": "center",
                            "color": "#222222"
                        }
                    },
                    {
                        selector: 'node[type=2]',
                        style: {
                            "shape": 'rectangle',
                            "background-color": "#FF8A8A",
                            "label": "data(label)",
                            'width': '350',
                            "height": "40",
                            "border-width": 2,
                            "border-color": "#484848",
                            "font-size": "16px",
                            "text-valign": "center",
                            "text-halign": "center",
                            "color": "#222222"
                        }
                    },
                    {
                        selector: 'node[type=3]',
                        style: {
                            "shape": 'rectangle',
                            "background-color": "#FF5C5C",
                            "label": "data(label)",
                            'width': '350',
                            "height": "40",
                            "border-width": 2,
                            "border-color": "#484848",
                            "font-size": "16px",
                            "text-valign": "center",
                            "text-halign": "center",
                            "color": "#222222"
                        }
                    },
                    {
                        selector: 'node[type=4]',
                        style: {
                            "shape": 'rectangle',
                            "background-color": "#FF0000",
                            "label": "data(label)",
                            'width': '350',
                            "height": "40",
                            "border-width": 2,
                            "border-color": "#484848",
                            "font-size": "16px",
                            "text-valign": "center",
                            "text-halign": "center",
                            "color": "#FFFFFF"
                        }
                    },
                    {
                        //process start node
                        selector: 'node[type=20]',
                        style: {
                            "shape": 'ellipse',
                            "background-color": "#3f3f3f",
                            "border-width": 4,
                            "border-color": "#131313",
                            'width': '50',
                            "height": "50",
                            "font-size": "16px",
                            "text-valign": "center",
                            "text-halign": "center",
                            "text-wrap": "wrap",
                            "text-max-width": "1000px",
                            "color": "#FF2222"
                        }
                    },

                    //Edges styles
                    {
                        selector: 'edge[type=0]',
                        style: {
                            'width': 3,
                            'curve-style': 'bezier',
                            "content": "data(name)",
                            "line-color": "#D1D1D1",
                            'target-arrow-color': '#D1D1D1',
                            "font-size": "32px",
                            "color": "#222222",
                            "loop-direction": "0deg",
                            'target-arrow-shape': 'triangle',
                            "loop-sweep": "45deg",
                            "text-margin-y": "-15px",
                            "source-text-offset": "50px"
                        }
                    },
                    {
                        selector: 'edge[type=1]',
                        style: {
                            'width': 5,
                            'curve-style': 'bezier',
                            "content": "data(name)",
                            "line-color": "#FFB7B7",
                            'target-arrow-color': '#FFB7B7',
                            "font-size": "32px",
                            "color": "#222222",
                            "loop-direction": "0deg",
                            'target-arrow-shape': 'triangle',
                            "loop-sweep": "45deg",
                            "text-margin-y": "-15px",
                            "source-text-offset": "50px"
                        }
                    },
                    {
                        selector: 'edge[type=2]',
                        style: {
                            'width': 7,
                            'curve-style': 'bezier',
                            "content": "data(name)",
                            "line-color": "#FF8A8A",
                            'target-arrow-color': '#FF8A8A',
                            "font-size": "32px",
                            "color": "#222222",
                            "loop-direction": "0deg",
                            'target-arrow-shape': 'triangle',
                            "loop-sweep": "45deg",
                            "text-margin-y": "-15px",
                            "source-text-offset": "50px"
                        }
                    },
                    {
                        selector: 'edge[type=3]',
                        style: {
                            'width': 9,
                            'curve-style': 'bezier',
                            "content": "data(name)",
                            "line-color": "#FF5C5C",
                            'target-arrow-color': '#FF5C5C',
                            "font-size": "32px",
                            "color": "#222222",
                            "loop-direction": "0deg",
                            'target-arrow-shape': 'triangle',
                            "loop-sweep": "45deg",
                            "text-margin-y": "-15px",
                            "source-text-offset": "50px"
                        }
                    },
                    {
                        selector: 'edge[type=4]',
                        style: {
                            'width': 13,
                            'curve-style': 'bezier',
                            "content": "data(name)",
                            "line-color": "#FF0000",
                            'target-arrow-color': '#FF0000',
                            "font-size": "32px",
                            "color": "#222222",
                            "loop-direction": "0deg",
                            'target-arrow-shape': 'triangle',
                            "loop-sweep": "45deg",
                            "text-margin-y": "-15px",
                            "source-text-offset": "50px"
                        }
                    },
                    {
                        //process start edge
                        selector: 'edge[type=20]',
                        style: {
                            'width': 8,
                            'curve-style': 'bezier',
                            'line-color': "#232323",
                            'target-arrow-color': '#232323',
                            "font-size": "32px",
                            "color": "#222222",
                            "loop-direction": "0deg",
                            'target-arrow-shape': 'triangle',
                            "loop-sweep": "45deg",
                            "text-margin-y": "-15px",
                            "source-text-offset": "50px",
                            "text-outline-color": "#222222",
                            "text-outline-width": "0.3px"
                        }
                    },
                ],
            });

        //find max time
        //nodes max time
        let nodesMaxTime = 0;
        for (let i = 0; i < process.nodeTimes.length; i++) {
            if (process.nodeTimes[i] > nodesMaxTime) {
                nodesMaxTime = process.nodeTimes[i];
            }
        }
        process.nodesMaxTime = nodesMaxTime;

        //edges max time
        let edgesMaxTime = 0;
        for (let i = 0; i < process.relationTimes.length; i++) {
            for (let j = 0; j < process.relationTimes[i].length; j++) {
                if (process.relationTimes[i][j] > edgesMaxTime) {
                    edgesMaxTime = process.relationTimes[i][j];
                }
            }
        }
        process.edgesMaxTime = edgesMaxTime;

        //Nodes\\
        for (let i = 0; i < process.data.nodes.length; i++) {
            let typeValue = Math.floor(process.nodeTimes[i] * 4 / nodesMaxTime);
            cy.add({
                data: {
                    id: i,
                    label: process.data.nodes[i] + ' (' + Math.round(process.nodeTimes[i]) + ')',
                    type: typeValue
                },
            }
            );
        }

        //Edges\\
        for (let i = 0; i < process.data.relations.length; i++) {
            for (let j = 0; j < process.data.relations[i].to.length; j++) {
                let typeValue = Math.round(process.relationTimes[i][j] * 4 / edgesMaxTime);
                cy.add({
                    data: {
                        id: 'edge' + process.data.relations[i].from + '-' + process.data.relations[i].to[j],
                        source: process.data.relations[i].from,
                        target: process.data.relations[i].to[j],
                        name: Math.round(process.relationTimes[i][j]),
                        type: typeValue
                    }
                });
            }
        }

        //add process start and end nodes
        for (let i = 0; i < process.data.startEvents.length; i++) {
            cy.add({
                data: {
                    id: 'start-' + i,
                    type: 20
                },
            });

            cy.add({
                data: {
                    id: 'edge_start-' + i,
                    source: 'start-' + i,
                    target: process.data.startEvents[i].node,
                    type: 20
                }
            });
        }

        for (let i = 0; i < process.data.endEvents.length; i++) {
            cy.add({
                data: {
                    id: 'end-' + i,
                    type: 20
                },
            });

            cy.add({
                data: {
                    id: 'edge_end-' + i,
                    source: process.data.endEvents[i].node,
                    target: 'end-' + i,
                    type: 20
                }
            });
        }

        let customBreadthfirst = {
            name: 'breadthfirst',

            fit: true, // whether to fit the viewport to the graph
            directed: true, // whether the tree is directed downwards (or edges can point in any direction if false)
            padding: 10, // padding on fit
            circle: false, // put depths in concentric circles if true, put depths top down if false
            grid: false, // whether to create an even grid into which the DAG is placed (circle:false only)
            spacingFactor: 0.90, // positive spacing factor, larger => more space between nodes (N.B. n/a if causes overlap)
            boundingBox: undefined, // constrain layout bounds; { x1, y1, x2, y2 } or { x1, y1, w, h }
            avoidOverlap: true, // prevents node overlap, may overflow boundingBox if not enough space
            nodeDimensionsIncludeLabels: false, // Excludes the label when calculating node bounding boxes for the layout algorithm
            roots: undefined, // the roots of the trees
            maximal: false, // whether to shift nodes down their natural BFS depths in order to avoid upwards edges (DAGS only)
            animate: false, // whether to transition the node positions
            animationDuration: 500, // duration of animation in ms if enabled
            animationEasing: undefined, // easing of animation if enabled,
            animateFilter: function (node, i) {
                return true;
            }, // a function that determines whether the node should be animated.  All nodes animated by default on animate enabled.  Non-animated nodes are positioned immediately when the layout starts
            ready: undefined, // callback on layoutready
            stop: undefined, // callback on layoutstop
            transform: function (node, position) {
                return position;
            } // transform a given node position. Useful for changing flow direction in discrete layouts
        };
        cy.layout(customBreadthfirst).run();
    }

    $("#centerButton").click(function () {
        if (typeof cy !== "undefined") {
            cy.fit();
        }
    });
    </script>
